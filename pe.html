<!DOCTYPE html>
<html>
<head>
<style>
textarea {
}
</style>
</head>
<body>

<h1>Parsing Explorer</h1>

<button onclick="generate ()">Generate Python from JSON drawing spec</button>

<br>
<p id="status" > READY </p>
<br>
<button onclick="fill1 ()">fill source fields for test1</button>
<button onclick="fill2 ()">fill source fields for test2</button>
<button onclick="fill3 ()">fill source fields for test3</button>


<p>src, grammar, fmt:</p>
<textarea id="src" rows="9" cols="40" placeholder="src" style="background-color:oldlace;">
</textarea>

<textarea id="grammar" rows="9" cols="40" placeholder="grammar" style="background-color:oldlace;">
</textarea>

<textarea id="fmt" rows="9" cols="40" placeholder="fmt" style="background-color:oldlace;">
</textarea>

<p>output:</p>
<textarea id="output" rows="17" cols="60" placeholder="output" style="background-color:oldlace;">
</textarea>

<br>
<br>
<br>

<!-- Ohm-JS -->
<script src="https://unpkg.com/ohm-js@16/dist/ohm.min.js"></script>


<!-- match rewriter tools fmt -->
    <script src="fmt-js.js"></script>
    <script src="transpile.js"></script>

<script>

/// example 1  ...
  const testsrc1 = String.raw`a`;

  const testgrammar1 = String.raw`
Test {
main = "a"
}
`;

  const testfmt1 = String.raw`
Test {
main [terminal] = ‛«terminal»’
}
`;
/// ... example 1

/// example 2  ...
  const testsrc2 = String.raw`
b
`;

  const testgrammar2 = String.raw`
Test {
Main = "b"
}
`;

  const testfmt2 = String.raw`
Test {
Main [terminal] = ‛«terminal»’
}
`;
/// ... example 2

/// example 3 ...
  const testsrc3 = String.raw`
www 
xxx
c,cc
`;

  const testgrammar3 = String.raw`
Test {
Main = PhraseW PhraseX PhraseY PhraseC
PhraseW = "w"*
PhraseX = "x"+
PhraseY = "y"?
PhraseC = ("c" ","?)+
}
`;

  const testfmt3 = String.raw`
Test {
Main [w x y c] = ‛«w»/«x»/«y»/«c»’
PhraseW [char*] = ‛«char»’
PhraseX [char+] = ‛«char»’
PhraseY [char?] = ‛«char»’
PhraseC [c+ optcomma+] = ‛hello «c»...«optcomma» world’
}
`;
/// ... example 3  


  function test (src, grammarName, grammar, fmt) {
      src = document.getElementById(src).value;
      grammar = document.getElementById(grammar).value;
      fmt = document.getElementById(fmt).value;
      [success, transpiled, errormessage] = transpile (src, grammarName, grammar, fmt);
      if (success) {
          document.getElementById('output').value = transpiled;
          document.getElementById('status').innerHTML = "OK";
      } else {
          document.getElementById('output').value = transpiled;
          document.getElementById('status').innerHTML = "FAILED " + errormessage;
      }
  }

  function fill (srctextarea, src, grammartextarea, grammar, fmttextarea, fmt) {
      document.getElementById(srctextarea).innerHTML = src;
      grammar = document.getElementById(grammartextarea).innerHTML = grammar;
      fmt = document.getElementById(fmttextarea).innerHTML = fmt;
  }
  
  function fill1 () {
      fill ('src', testsrc1, 'grammar', testgrammar1, 'fmt', testfmt1);
  }
  function fill2 () {
      fill ('src', testsrc2, 'grammar', testgrammar2, 'fmt', testfmt2);
  }
  function fill3 () {
      fill ('src', testsrc3, 'grammar', testgrammar3, 'fmt', testfmt3);
  }
  
  function generate () {
      test ('src', 'Test', 'grammar', 'fmt');
  }
  
  </script>
</body>
</html>


